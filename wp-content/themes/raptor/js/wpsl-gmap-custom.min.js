jQuery(document).ready(function(e){function t(t,s){var n,i,o,p,u,f;Me=r(s),f=Number(Me.zoomLevel),i=c(),ae=new google.maps.Geocoder,re=new google.maps.DirectionsRenderer,pe=new google.maps.DirectionsService,re.addListener("directions_changed",function(){google.maps.event.addListenerOnce(le,"bounds_changed",function(){I(240)})}),n={zoom:Number(Me.zoomLevel),center:Me.startLatLng,mapTypeId:google.maps.MapTypeId[Me.mapType.toUpperCase()],mapTypeControl:!!Number(Me.mapTypeControl),scrollwheel:!!Number(Me.scrollWheel),streetViewControl:!!Number(Me.streetView),gestureHandling:Me.gestureHandling,zoomControlOptions:{position:google.maps.ControlPosition[Me.controlPosition.toUpperCase()+"_TOP"]},maxZoom:18},be=d(),le=new google.maps.Map(document.getElementById(t),n),g(Me.mapStyle),void 0!==window["wpslMap_"+s]&&void 0!==window["wpslMap_"+s].locations&&(p=new google.maps.LatLngBounds,u=window["wpslMap_"+s].locations,e.each(u,function(e){o=new google.maps.LatLng(u[e].lat,u[e].lng),D(o,u[e].id,u[e],!1,i),p.extend(o)}),le.fitBounds(p),google.maps.event.addListenerOnce(le,"bounds_changed",function(e){return function(){e.getZoom()>f&&e.setZoom(f)}}(le))),e("#wpsl-gmap").length&&(1==wpslSettings.autoComplete&&a(),!m()&&e(".wpsl-dropdown").length&&1==wpslSettings.enableStyledDropdowns?ne():(e("#wpsl-search-wrap select").show(),m()?e("#wpsl-wrap").addClass("wpsl-mobile"):e("#wpsl-wrap").addClass("wpsl-default-filters")),e(".wpsl-search").hasClass("wpsl-widget")||e("#wpsl-search-input").val()||(1==wpslSettings.autoLocate?h(Me.startLatLng,i):1==wpslSettings.autoLoad&&w(Me.startLatLng,i)),1!=wpslSettings.mouseFocus||m()||e("#wpsl-search-input").focus(),b(i),C(Me,le,i),oe()),l(),e("#wpsl-search-input").val()&&e("#wpsl-search-btn").trigger("click")}function s(t){if(t.which<=90&&t.which>=48||32==t.which||8==t.which){e(".pac-item.custom-item").each(function(){e(this).remove()});var s=t.target.value,o=s.toLowerCase(),a=0,l=[];e('input[name="retailer"]:checked').each(function(){l.push(e(this).val())});var r=[];e('input[name="range"]:checked').each(function(){r.push(e(this).val())});var p=[];e('input[name="sub_range"]:checked').each(function(){p.push(e(this).val())}),Le.length>0&&Le.forEach(function(t){if(-1!==t.title.toLowerCase().indexOf(o)&&a<5&&(l.length<1||-1!==l.indexOf(t.retailer_id))&&(r.length<1||i(r,t.ranges))&&(p.length<1||i(p,t.subranges))){var c=t.title;e(".pac-container").append('<div class="pac-item custom-item" data-item-id="'+t.id+'" data-item-lat="'+t.lat+'" data-item-lng="'+t.lng+'"><span class="_retailer-mark">R</span><span class="pac-item-query">'+n(s,c)+"</span><span>"+t.city+", "+t.address+"</span></div>"),a++}})}}function n(e,t){var s=e.toLowerCase(),n=t.toLowerCase(),i=n.indexOf(s);return i>=0&&(t=t.substring(0,i)+'<span class="pac-matched">'+t.substring(i,i+e.length)+"</span>"+t.substring(i+e.length)),t}function i(e,t){return e.some(function(e){return t.indexOf(e)>-1})}function o(t){function s(s,i){if("keydown"==s){var o=i;i=function(s){var n=e(".pac-item-selected").length>0,i=e(".custom-item").length>0,a=e(".custom-item.pac-item-selected").length>0,l=e(".custom-item.pac-item-selected");if(13!=s.which||n)if(13==s.which&&a)l.trigger("touchstart"),e(".pac-container").css("display","none");else if(38==s.which&&i)if(!n||e(".pac-item.custom-item").first().hasClass("pac-item-selected"))o.apply(t,[s]),e(".pac-item.custom-item").removeClass("pac-item-selected");else if(a||e(".pac-item-selected").prev().hasClass("custom-item")){e(".pac-container").show();var p=e(".pac-item-selected");p.prev().addClass("pac-item-selected"),p.removeClass("pac-item-selected"),setTimeout(function(){t.value=p.prev().find(".pac-item-query").text()})}else o.apply(t,[s]);else 40==s.which&&i?n?a&&l.next().hasClass("custom-item")?(e(".pac-container").show(),l.next().addClass("pac-item-selected"),l.removeClass("pac-item-selected"),t.value=l.next().find(".pac-item-query").text()):(e(".custom-item.pac-item-selected").removeClass("pac-item-selected"),o.apply(t,[s])):(e(".pac-container").show(),e(".custom-item").first().addClass("pac-item-selected"),t.value=e(".custom-item").first().find(".pac-item-query").text()):o.apply(t,[s]);else{var d=e(".pac-item").first(),g=!1;if(ke.length>0&&""!==t.value&&ke.forEach(function(s){if(!g){var n=s.title,i=s.title.toLowerCase(),o=t.value.toLowerCase();if(i=i.replace(/'/g,""),i=i.replace(/`/g,""),o=o.replace(/'/g,""),o=o.replace(/`/g,""),-1!==i.indexOf(o)){e('input[name="retailer"]:checked').each(function(){e(this).prop("checked",!1),e(this).parent().removeClass("active")}),e('input[name="retailer"][value='+s.id+"]").prop("checked",!0),e('input[name="retailer"][value='+s.id+"]").parent().addClass("active"),t.value=n;var a=r(0);ue=c(),w(a.startLatLng,ue),g=!0,e(".pac-container").css("display","none")}}}),!g)if(d.hasClass("custom-item"))d.trigger("touchstart"),e(".pac-container").css("display","none");else{var u=e.Event("keydown",{keyCode:40,which:40});o.apply(t,[u]),o.apply(t,[s])}}}}n.apply(t,[s,i])}var n=t.addEventListener?t.addEventListener:t.attachEvent;t.addEventListener=s,t.attachEvent=s}function a(){var t,n,i,a={};void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)||(a.componentRestrictions=wpslSettings.geocodeComponents),t=document.getElementById("wpsl-search-input"),o(t),n=new google.maps.places.Autocomplete(t,a),t.addEventListener("keyup",s),n.addListener("place_changed",function(){i=n.getPlace(),i.geometry&&(de=i.geometry.location),e("#wpsl-search-btn").trigger("click")})}function l(){void 0!==wpslSettings.markerZoomTo&&1==wpslSettings.markerZoomTo&&google.maps.event.addListener(le,"zoom_changed",function(){H()})}function r(e){var t,s,n,i=["zoomLevel","mapType","mapTypeControl","mapStyle","streetView","scrollWheel","controlPosition"],o={zoomLevel:wpslSettings.zoomLevel,mapType:wpslSettings.mapType,mapTypeControl:wpslSettings.mapTypeControl,mapStyle:wpslSettings.mapStyle,streetView:wpslSettings.streetView,scrollWheel:wpslSettings.scrollWheel,controlPosition:wpslSettings.controlPosition,gestureHandling:wpslSettings.gestureHandling};if(void 0!==window["wpslMap_"+e]&&void 0!==window["wpslMap_"+e].shortCode)for(t=0,s=i.length;t<s;t++)void 0!==(n=window["wpslMap_"+e].shortCode[i[t]])&&(o[i[t]]=n);return o.startLatLng=p(e),o}function p(e){var t,s,n="";return void 0!==window["wpslMap_"+e]&&void 0!==window["wpslMap_"+e].locations&&(n=window["wpslMap_"+e].locations[0]),void 0!==n&&void 0!==n.lat&&void 0!==n.lng?t=new google.maps.LatLng(n.lat,n.lng):""!==wpslSettings.startLatlng?(s=wpslSettings.startLatlng.split(","),t=new google.maps.LatLng(s[0],s[1])):t=new google.maps.LatLng(0,0),t}function c(){var e,t,s={};return void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle?(e=wpslSettings.infoBoxClearance.split(","),t=wpslSettings.infoBoxPixelOffset.split(","),s={alignBottom:!0,boxClass:wpslSettings.infoBoxClass,closeBoxMargin:wpslSettings.infoBoxCloseMargin,closeBoxURL:wpslSettings.infoBoxCloseUrl,content:"",disableAutoPan:!!Number(wpslSettings.infoBoxDisableAutoPan),enableEventPropagation:!!Number(wpslSettings.infoBoxEnableEventPropagation),infoBoxClearance:new google.maps.Size(Number(e[0]),Number(e[1])),pixelOffset:new google.maps.Size(Number(t[0]),Number(t[1])),zIndex:Number(wpslSettings.infoBoxZindex)},ue=new InfoBox(s)):ue=new google.maps.InfoWindow,ue}function d(){var e,t=wpslSettings.markerIconProps,s={};void 0!==t.url?s.url=t.url:void 0!==t.categoryMarkerUrl?s.categoryMarkerUrl=t.categoryMarkerUrl:void 0!==t.alternateMarkerUrl?s.alternateMarkerUrl=t.alternateMarkerUrl:s.url=wpslSettings.url+"img/markers/";for(var n in t)t.hasOwnProperty(n)&&(e=t[n].split(","),2==e.length&&(s[n]=e));return s}function g(e){(e=u(e))&&le.setOptions({styles:e})}function u(e){try{var t=JSON.parse(e);if(t&&"object"==typeof t&&null!==t)return t}catch(e){}return!1}function w(e,t){D(e,0,"",!0,t),B(e,ye,_e,t)}function m(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function h(t,s){if(navigator.geolocation){var n,i,o=Number(wpslSettings.geoLocationTimout);n=setInterval(function(){e(".wpsl-icon-direction").toggleClass("wpsl-active-icon")},600),i=setTimeout(function(){f(n),w(t,s)},o),navigator.geolocation.getCurrentPosition(function(o){f(n),clearTimeout(i),ee(!1),v(t,o,ye,s),e(".wpsl-search").addClass("wpsl-geolocation-run")},function(n){if(e(".wpsl-icon-direction").hasClass("wpsl-user-activated")&&!e(".wpsl-search").hasClass("wpsl-geolocation-run")){switch(n.code){case n.PERMISSION_DENIED:alert(wpslGeolocationErrors.denied);break;case n.POSITION_UNAVAILABLE:alert(wpslGeolocationErrors.unavailable);break;case n.TIMEOUT:alert(wpslGeolocationErrors.timeout);break;default:alert(wpslGeolocationErrors.generalError)}e(".wpsl-icon-direction").removeClass("wpsl-active-icon")}else e(".wpsl-search").hasClass("wpsl-geolocation-run")||(clearTimeout(i),w(t,s))},{maximumAge:6e4,timeout:o,enableHighAccuracy:!0})}else alert(wpslGeolocationErrors.unavailable),w(t,s)}function f(t){clearInterval(t),e(".wpsl-icon-direction").removeClass("wpsl-active-icon")}function v(e,t,s,n){if(void 0===t)w(e,n);else{var i=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);ce=t,O(i),le.setCenter(i),D(i,0,"",!0,n),B(i,s,_e,n)}}function b(t){e("#wpsl-search-btn").unbind("click").bind("click",function(s){return e("#wpsl-search-input").removeClass(),e("#wpsl-result-list ul").empty(),e("#wpsl-stores").show(),e(".wpsl-direction-before, .wpsl-direction-after").remove(),e("#wpsl-direction-details").hide(),ye=!1,S(),ee(!1),k(),1==wpslSettings.autoComplete&&void 0!==de?T(de,t):P(t),!1})}function S(){void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&void 0!==fe[0]&&fe[0].close()}function C(t,s,n){google.maps.event.addListenerOnce(s,"tilesloaded",function(){e(".gm-style").append(wpslSettings.mapControls),e(".wpsl-icon-reset, #wpsl-reset-map").length>0&&(L(t.startLatLng,n),e(".wpsl-icon-reset").hide()),e(".wpsl-icon-direction").on("click",function(){e(this).addClass("wpsl-user-activated"),h(t.startLatLng,n)})})}function L(t,s){e(".wpsl-icon-reset, #wpsl-reset-map").on("click",function(){e(this).hasClass("wpsl-in-progress")||(1==wpslSettings.autoLoad&&(_e=1),le.getCenter().lat()===Ce.centerLatlng.lat()&&le.getCenter().lng()===Ce.centerLatlng.lng()&&le.getZoom()===Ce.zoomLevel||(ee(!1),e("#wpsl-search-input").val("").removeClass(),e(".wpsl-icon-reset").addClass("wpsl-in-progress"),we&&we.clearMarkers(),k(),y(),1==wpslSettings.autoLocate?v(t,ce,!0,s):w(t,s)),e("#wpsl-stores").show(),e("#wpsl-direction-details").hide())})}function k(){void 0!==me&&""!==me&&(me.setMap(null),me="")}function y(){var t,s,n,i,o,a,l,r,p=e("#wpsl-wrap").hasClass("wpsl-default-filters"),c=[wpslSettings.searchRadius+" "+wpslSettings.distanceUnit,wpslSettings.maxResults],d=["wpsl-radius","wpsl-results"];for(t=0,s=d.length;t<s;t++)e("#"+d[t]+" select").val(parseInt(c[t])),e("#"+d[t]+" li").removeClass(),"wpsl-radius"==d[t]?n=wpslSettings.searchRadius:"wpsl-results"==d[t]&&(n=wpslSettings.maxResults),e("#"+d[t]+" li").each(function(){e(this).text()===c[t]&&(e(this).addClass("wpsl-selected-dropdown"),e("#"+d[t]+" .wpsl-selected-item").html(c[t]).attr("data-value",n))});e("#wpsl-category").length&&(e("#wpsl-category select").val(0),e("#wpsl-category li").removeClass(),e("#wpsl-category li:first-child").addClass("wpsl-selected-dropdown"),i=e("#wpsl-category li:first-child").text(),e("#wpsl-category .wpsl-selected-item").html(i).attr("data-value",0)),e(".wpsl-custom-dropdown").length>0&&e(".wpsl-custom-dropdown").each(function(t){p?e(this).find("option").removeAttr("selected"):(o=e(this).siblings("div"),a=o.find("li:first-child"),l=a.text(),r=a.attr("data-value"),o.find("li").removeClass(),o.prev().html(l).attr("data-value",r))})}function x(t){var s,n,i,o,a;for(S(),a=t.parents("li").length>0?t.parents("li").data("store-id"):t.parents(".wpsl-info-window").data("store-id"),void 0!==me&&""!==me&&(n=me.getPosition()),Se={centerLatlng:le.getCenter(),zoomLevel:le.getZoom()},s=0,o=ve.length;s<o;s++)0!=ve[s].storeId||void 0!==n&&""!==n?ve[s].storeId==a&&(i=ve[s].getPosition()):n=ve[s].getPosition();n&&i?(e("#wpsl-direction-details ul").empty(),e(".wpsl-direction-before, .wpsl-direction-after").remove(),N(n,i)):alert(wpslLabels.generalError)}function E(t){var s=t.next().clone();e(s).hasClass("_twist-modal-popup")&&(e("body").addClass("modal-opened"),e(s).addClass("active"),e(s).appendTo("body").show())}function I(e,t){if(!Ie){var s=Math.pow(2,le.getZoom()),n=n||le.getCenter(),i=le.getProjection().fromLatLngToPoint(n),o=new google.maps.Point(e/s||0,t/s||0),a=new google.maps.Point(i.x-o.x,i.y+o.y),l=le.getProjection().fromPointToLatLng(a);le.setCenter(l)}}function M(e,t){var s,n,i;for(s=0,n=ve.length;s<n;s++)ve[s].storeId==e&&(i=ve[s],"start"==t?i.setAnimation(google.maps.Animation.BOUNCE):i.setAnimation(null))}function N(t,s){var n,i,o,a,l,r,p,c,d,g="",u={};c="km"==wpslSettings.distanceUnit?"METRIC":"IMPERIAL",u={origin:t,destination:s,travelMode:wpslSettings.directionsTravelMode,unitSystem:google.maps.UnitSystem[c]},pe.route(u,function(t,s){if(s==google.maps.DirectionsStatus.OK){if(Ee=!0,re.setMap(le),re.setDirections(t),t.routes.length>0){for(l=t.routes[0],r=0;r<l.legs.length;r++)for(n=l.legs[r],p=0,i=n.steps.length;p<i;p++)o=n.steps[p],a=p+1,g=g+"<li><div class='wpsl-direction-index'>"+a+"</div><div class='wpsl-direction-txt'>"+o.instructions+"</div><div class='wpsl-direction-distance'>"+o.distance.text+"</div></li>";for(e("#wpsl-direction-details ul").append(g).before("<div class='wpsl-direction-before'><a class='wpsl-back' id='wpsl-direction-start' href='#'>"+wpslLabels.back+"</a><div><span class='wpsl-total-distance'>"+l.legs[0].distance.text+"</span> - <span class='wpsl-total-durations'>"+l.legs[0].duration.text+"</span></div></div>").after("<p class='wpsl-direction-after'>"+t.routes[0].copyrights+"</p>"),r=0,i=ve.length;r<i;r++)ve[r].setMap(null);we&&we.clearMarkers(),void 0!==me&&""!==me&&me.setMap(null),e("#wpsl-stores").hide(),1==wpslSettings.templateId&&(d=e("#wpsl-gmap").offset(),e(window).scrollTop(d.top))}}else se(s)})}function P(t){var s,n={address:e("#wpsl-search-input").val()};if(!e("#wpsl-search-input").val())return void T(Me.startLatLng,t);void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)||(n.componentRestrictions=wpslSettings.geocodeComponents),ae.geocode(n,function(e,n){n==google.maps.GeocoderStatus.OK?(s=e[0].geometry.location,T(s,t)):te(n)})}function T(e,t){D(e,0,"",!0,t),B(e,ye,!1,t)}function O(t){var s;ae.geocode({latLng:t},function(t,n){n==google.maps.GeocoderStatus.OK?""!==(s=R(t))&&e("#wpsl-search-input").val(s):te(n)})}function R(e){var t,s,n,i=e[0].address_components.length;for(n=0;n<i;n++)s=e[0].address_components[n].types,(/^postal_code$/.test(s)||/^postal_code_prefix,postal_code$/.test(s))&&(t=e[0].address_components[n].long_name);return t}function B(e,t,s,n){1==wpslSettings.directionRedirect?z(e,function(){U(e,t,s,n)}):U(e,t,s,n)}function z(e,t){ae.geocode({latLng:e},function(e,s){s==google.maps.GeocoderStatus.OK?(he=e[0].formatted_address,t()):te(s)})}function U(t,s,n,i){var o,a,l={},r="",p=e("#wpsl-listing-template").html(),c=e("#wpsl-stores ul"),d=wpslSettings.url+"img/ajax-loader.gif";l=Z(t,s,n),c.empty().append("<li class='wpsl-preloader'><img src='"+d+"'/>"+wpslLabels.preloader+"</li>"), jQuery(".app-filter-result__detail-box").removeClass("opened").css({"display":"block", "transform":"translateX(0%)"}), console.log("show 2"),e(".find-form__result").text("");var g="";e.get(wpslSettings.ajaxurl,l,function(s){if(e(".wpsl-preloader, .no-results").remove(),s.length>0){g="Showing the "+s.length+" closest retailers",e("#wpsl-search-input").val()&&(g+=" to "+e("#wpsl-search-input").val());var n="";e('input[name="range"]:checked').each(function(){var t=e(this).parent().text().trim();t=t.replace(/[^\w\s]/gi,""),n+=""==n?t:", "+t}),e('input[name="sub_range"]:checked').each(function(){var t=e(this).parent().text().trim();t=t.replace(/[^\w\s]/gi,""),n+=""==n?t:", "+t}),""!==n&&(g+=" selling "+n+" mattresses"),e.each(s,function(e){_.extend(s[e],ze),o=new google.maps.LatLng(s[e].lat,s[e].lng),D(o,s[e].id,s[e],!1,i),r+=_.template(p)(s[e])}),e("#wpsl-result-list").off("click",".wpsl-directions"),c.empty(),c.append(r),e("#wpsl-result-list").on("click",".wpsl-directions",function(){if(1!=wpslSettings.directionRedirect)return e("#mapView").trigger("click"),x(e(this)),!1}),j(),e("#wpsl-result-list p:empty").remove(); window.toggleSpecialOffers(); }else g="No results",D(t,0,"",!0,i),a=A(),c.html("<li class='no-results'>"+a+"</li>");e(".find-form__result").text(g),1==wpslSettings.runFitBounds?X():(le.setZoom(Number(wpslSettings.zoomLevel)),le.setCenter(ve[0].position)),1==wpslSettings.resetMap&&(e.isEmptyObject(Ce)&&google.maps.event.addListenerOnce(le,"tilesloaded",function(){Ce={centerLatlng:le.getCenter(),zoomLevel:le.getZoom()},e("#wpsl-map-controls").addClass("wpsl-reset-exists"),e(".wpsl-icon-reset, #wpsl-reset-map").show()}),e(".wpsl-icon-reset").removeClass("wpsl-in-progress"))}),1!=wpslSettings.mouseFocus||m()||e("#wpsl-search-input").focus()}function V(t,s,n){var i,o,a,l,p={},d="",g=e("#wpsl-listing-template").html(),u=e("#wpsl-stores ul"),w=wpslSettings.url+"img/ajax-loader.gif",h=r(0),f=c();p={action:"store_search",max_results:wpslSettings.maxResults,search_radius:wpslSettings.searchRadius,lat:s,lng:n,item_id:t};var v=[];e('input[name="retailer"]:checked').each(function(){v.push(e(this).val())}),p.retailers=v;var b=[];e('input[name="range"]:checked').each(function(){b.push(e(this).val())}),p.ranges=b;var S=[];e('input[name="sub_range"]:checked').each(function(){S.push(e(this).val())}),p.sub_ranges=S,u.empty().append("<li class='wpsl-preloader'><img src='"+w+"'/>"+wpslLabels.preloader+"</li>"), console.log("show") ,e(".find-form__result").text("");var C="";e.get(wpslSettings.ajaxurl,p,function(s){if(e(".wpsl-preloader, .no-results").remove(),s.length>0){C="Showing the "+e("#wpsl-search-input").val()+" retailer";var n="";for(e('input[name="range"]:checked').each(function(){var t=e(this).parent().text().trim();t=t.replace(/[^\w\s]/gi,""),n+=""==n?t:", "+t}),e('input[name="sub_range"]:checked').each(function(){var t=e(this).parent().text().trim();t=t.replace(/[^\w\s]/gi,""),n+=""==n?t:", "+t}),""!==n&&(C+=" selling "+n+" mattresses"),e.each(s,function(e){_.extend(s[e],ze),i=new google.maps.LatLng(s[e].lat,s[e].lng),D(i,s[e].id,s[e],!1,f),d+=_.template(g)(s[e])}),Re=0,l=ve.length;Re<l;Re++)if(ve[Re].storeId==t){a=ve[Re];var r=new google.maps.LatLngBounds;r.extend(a.getPosition()),le.fitBounds(r),Ne=r,I(240);break}e("#wpsl-result-list").off("click",".wpsl-directions"),u.empty(),u.append(d),e("#wpsl-result-list").on("click",".wpsl-directions",function(){if(1!=wpslSettings.directionRedirect)return e("#mapView").trigger("click"),x(e(this)),!1}),j(),e("#wpsl-result-list p:empty").remove()}else C="No results",D(h.startLatLng,0,"",!0,f),o=A(),u.html("<li class='no-results'>"+o+"</li>"),le.setZoom(Number(wpslSettings.zoomLevel)),le.setCenter(ve[0].position);e(".find-form__result").text(C)}),1!=wpslSettings.mouseFocus||m()||e("#wpsl-search-input").focus()}function Z(t,s,n){var i,o,a,l,r,p="",c=e("#wpsl-wrap").hasClass("wpsl-mobile"),d=e("#wpsl-wrap").hasClass("wpsl-default-filters"),g={action:"store_search",lat:t.lat(),lng:t.lng()};s?(g.max_results=wpslSettings.maxResults,g.search_radius=wpslSettings.searchRadius):(c||d?(i=parseInt(e("#wpsl-results .wpsl-dropdown").val()),o=parseInt(e("#wpsl-radius .wpsl-dropdown").val())):(i=parseInt(e("#wpsl-results .wpsl-selected-item").attr("data-value")),o=parseInt(e("#wpsl-radius .wpsl-selected-item").attr("data-value"))),isNaN(i)?g.max_results=wpslSettings.maxResults:g.max_results=i,isNaN(o)?g.search_radius=wpslSettings.searchRadius:g.search_radius=o,void 0!==wpslSettings.categoryIds?g.filter=wpslSettings.categoryIds:e("#wpsl-category").length>0?(p=c||d?parseInt(e("#wpsl-category .wpsl-dropdown").val()):parseInt(e("#wpsl-category .wpsl-selected-item").attr("data-value")),isNaN(p)||0===p||(g.filter=p)):e("#wpsl-checkbox-filter").length>0&&e("#wpsl-checkbox-filter input:checked").length>0&&(g.filter=W()),e(".wpsl-custom-dropdown").length>0&&e(".wpsl-custom-dropdown").each(function(t){a="",l="",c||d?(a=e(this).attr("name"),l=e(this).val()):(a=e(this).attr("name"),l=e(this).next(".wpsl-selected-item").attr("data-value")),a&&l&&(g[a]=l)}),e(".wpsl-custom-checkboxes").length>0&&e(".wpsl-custom-checkboxes").each(function(t){(r=e(this).attr("data-name"))&&(g[r]=$(r))})),1==n&&(void 0!==ce?g.skip_cache=1:(g.autoload=1,void 0!==wpslSettings.categoryIds&&(g.filter=wpslSettings.categoryIds))),void 0!==wpslSettings.collectStatistics&&0==n&&(g.search=e("#wpsl-search-input").val());var u=[];e('input[name="retailer"]:checked').each(function(){u.push(e(this).val())}),g.retailers=u;var w=[];e('input[name="range"]:checked').each(function(){w.push(e(this).val())}),g.ranges=w;var m=[];e('input[name="sub_range"]:checked').each(function(){m.push(e(this).val())}),g.sub_ranges=m;var h=[];return e('input[name="collections"]:checked').each(function(){h.push(e(this).val())}),g.collections=h,g}function $(t){var s=e("[data-name="+t+"]"),n=[];return e(s).find("input:checked").each(function(t){n.push(e(this).val())}),n.join()}function A(){return void 0!==wpslSettings.noResults&&""!==wpslSettings.noResults?wpslSettings.noResults:wpslLabels.noResults}function W(){var t=e("#wpsl-checkbox-filter input:checked").map(function(){return e(this).val()});return t=t.get(),t=t.join(",")}function j(){if(1==wpslSettings.markerClusters){var e,t,s=Number(wpslSettings.clusterZoom),n=Number(wpslSettings.clusterSize);isNaN(s)&&(s=""),isNaN(n)&&(n=""),void 0!==wpslSettings.excludeStartFromCluster&&1==wpslSettings.excludeStartFromCluster&&(t=ve.slice(0),t.splice(0,1)),e=void 0===t?ve:t,we=new MarkerClusterer(le,e,{gridSize:n,maxZoom:s})}}function D(e,t,s,n,i){var o,a,l;0===t?(s={store:wpslLabels.startPoint},o=be.url+wpslSettings.startMarker):void 0!==s.alternateMarkerUrl&&s.alternateMarkerUrl?o=s.alternateMarkerUrl:void 0!==s.categoryMarkerUrl&&s.categoryMarkerUrl?o=s.categoryMarkerUrl:(o=be.url+wpslSettings.storeMarker,o=s.offers?"/wp-content/themes/raptor/img/markers/marker-fill.png":"/wp-content/themes/raptor/img/markers/marker.png"),a={url:o,scaledSize:new google.maps.Size(Number(be.scaledSize[0]),Number(be.scaledSize[1])),origin:new google.maps.Point(Number(be.origin[0]),Number(be.origin[1])),anchor:new google.maps.Point(Number(be.anchor[0]),Number(be.anchor[1]))},l=new google.maps.Marker({position:e,map:le,optimized:!1,title:G(s.store),draggable:n,storeId:t,icon:a}),ve.push(l),google.maps.event.addListener(l,"click",function(n){return function(){0!=t?void 0!==wpslSettings.markerStreetView&&1==wpslSettings.markerStreetView?Y(e,function(){q(l,J(s),i,n)}):q(l,J(s),i,n):q(l,wpslLabels.startPoint,i,n),google.maps.event.clearListeners(i,"domready"),google.maps.event.addListener(i,"domready",function(){F(l,n),H()})}}(le)),n&&google.maps.event.addListener(l,"dragend",function(e){ee(!0),le.setCenter(e.latLng),O(e.latLng),B(e.latLng,ye,_e=!1,i)})}function G(e){if(e)return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)})}function q(e,t,s,n){fe.length=0,s.setContent(t),s.open(n,e),fe.push(s),void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&1==wpslSettings.markerClusters&&(ge=e.storeId,s.setVisible(!0))}function F(t,s){e(".wpsl-info-actions a").on("click",function(n){var i=Number(wpslSettings.autoZoomLevel);if(n.stopImmediatePropagation(),e(this).hasClass("wpsl-directions")){if(1==wpslSettings.directionRedirect)return!0;x(e(this))}else e(this).hasClass("wpsl-streetview")?K(t,s):e(this).hasClass("wpsl-zoom-here")&&(s.setCenter(t.getPosition()),s.setZoom(i));return!1})}function H(){le.getZoom()>=wpslSettings.autoZoomLevel?e(".wpsl-zoom-here").hide():e(".wpsl-zoom-here").show()}function K(t,s){var n=s.getStreetView();n.setPosition(t.getPosition()),n.setVisible(!0),e("#wpsl-map-controls").hide(),Q(n,s)}function Q(t,s){google.maps.event.addListener(t,"visible_changed",function(){if(!t.getVisible()){var n=s.getZoom();e("#wpsl-map-controls").show(),s.setZoom(n-1),s.setZoom(n)}})}function Y(e,t){(new google.maps.StreetViewService).getPanoramaByLocation(e,50,function(e,s){xe=s==google.maps.StreetViewStatus.OK,t()})}function J(t){var s;return s=e("#wpsl-base-gmap_0").length?e("#wpsl-cpt-info-window-template").html():e("#wpsl-info-window-template").html(),_.template(s)(t)}function X(){var e,t,s=Number(wpslSettings.autoZoomLevel),n=new google.maps.LatLngBounds;for(google.maps.event.addListenerOnce(le,"bounds_changed",function(e){this.getZoom()>s&&this.setZoom(s)}),e=0,t=ve.length;e<t;e++)n.extend(ve[e].position);le.fitBounds(n)}function ee(e){var t,s;if(Ee=!1,re.setMap(null),ve){for(s=0,t=ve.length;s<t;s++)e?1!=ve[s].draggable?ve[s].setMap(null):me=ve[s]:ve[s].setMap(null);ve.length=0}we&&we.clearMarkers()}function te(e){var t;switch(e){case"ZERO_RESULTS":t=wpslLabels.noResults;break;case"OVER_QUERY_LIMIT":t=wpslLabels.queryLimit;break;default:t=wpslLabels.generalError}alert(t)}function se(e){var t;switch(e){case"NOT_FOUND":case"ZERO_RESULTS":t=wpslLabels.noDirectionsFound;break;case"OVER_QUERY_LIMIT":t=wpslLabels.queryLimit;break;default:t=wpslLabels.generalError}alert(t)}function ne(){var t=Number(wpslSettings.maxDropdownHeight);e(".wpsl-dropdown").each(function(s){var n,i,o=e(this);o.$dropdownWrap=o.wrap("<div class='wpsl-dropdown'></div>").parent(),o.$selectedVal=o.val(),o.$dropdownElem=e("<div><ul/></div>").appendTo(o.$dropdownWrap),o.$dropdown=o.$dropdownElem.find("ul"),o.$options=o.$dropdownWrap.find("option"),o.hide().removeClass("wpsl-dropdown"),e.each(o.$options,function(){n=e(this).val()==o.$selectedVal?'class="wpsl-selected-dropdown"':"",o.$dropdown.append("<li data-value="+e(this).val()+" "+n+">"+e(this).text()+"</li>")}),o.$dropdownElem.before("<span data-value="+o.find(":selected").val()+" class='wpsl-selected-item'>"+o.find(":selected").text()+"</span>"),o.$dropdownItem=o.$dropdownElem.find("li"),o.$dropdownWrap.on("click",function(s){if(e(this).hasClass("wpsl-active"))return void e(this).removeClass("wpsl-active");ie(),e(this).toggleClass("wpsl-active"),i=0,e(this).hasClass("wpsl-active")?(o.$dropdownItem.each(function(t){i+=e(this).outerHeight()}),o.$dropdownElem.css("height",i+2+"px")):o.$dropdownElem.css("height",0),i>t&&(e(this).addClass("wpsl-scroll-required"),o.$dropdownElem.css("height",t+"px")),s.stopPropagation()}),o.$dropdownItem.on("click",function(t){o.$dropdownWrap.find(e(".wpsl-selected-item")).html(e(this).text()).attr("data-value",e(this).attr("data-value")),o.$dropdownItem.removeClass("wpsl-selected-dropdown"),e(this).addClass("wpsl-selected-dropdown"),ie(),t.stopPropagation()})}),e(document).click(function(){ie()})}function ie(){e(".wpsl-dropdown").removeClass("wpsl-active"),e(".wpsl-dropdown div").css("height",0)}function oe(){e(".wpsl-search").hasClass("wpsl-widget")&&(e("#wpsl-search-btn").trigger("click"),e(".wpsl-search").removeClass("wpsl-widget"))}var ae,le,re,pe,ce,de,ge,ue,we,me,he,fe=[],ve=[],be={},Se={},Ce={},Le=wpslAjaxVariables.retailers,ke=wpslAjaxVariables.retailers_groups,ye=!1,xe=!1,_e="undefined"!=typeof wpslSettings?wpslSettings.autoLoad:"",Ee=!1,Ie=window.innerWidth<992;_.templateSettings={evaluate:/\<\%(.+?)\%\>/g,interpolate:/\<\%=(.+?)\%\>/g,escape:/\<\%-(.+?)\%\>/g},e(".wpsl-gmap-canvas").length&&(e("<img />").attr("src",wpslSettings.url+"img/ajax-loader.gif"),e(".wpsl-gmap-canvas").each(function(s){t(e(this).attr("id"),s)}));var Me;e("#wpsl-result-list").on("click",".wpsl-back",function(){var t,s;for(re.setMap(null),Ee=!1,t=0,s=ve.length;t<s;t++)ve[t].setMap(le);return void 0!==me&&""!==me&&me.setMap(le),we&&j(),le.setCenter(Se.centerLatlng),le.setZoom(Se.zoomLevel),e(".wpsl-direction-before, .wpsl-direction-after").remove(),e("#wpsl-stores").show(), console.log("show"),e("#wpsl-direction-details").hide(),!1}),e("#wpsl-gmap").length&&("bounce"==wpslSettings.markerEffect?(e("#wpsl-stores").on("mouseenter","li",function(){M(e(this).data("store-id"),"start")}),e("#wpsl-stores").on("mouseleave","li",function(){M(e(this).data("store-id"),"stop")})):"info_window"==wpslSettings.markerEffect&&e("#wpsl-stores").on("mouseenter","li",function(){var t,s;for(t=0,s=ve.length;t<s;t++)ve[t].storeId==e(this).data("store-id")&&(google.maps.event.trigger(ve[t],"click"),le.setCenter(ve[t].position))}),e("#wpsl-stores").on("click",".js-show-store-details",function(){var t=e(this),s=t.closest("li").data("store-id");for(E(t),Re=0,len=ve.length;Re<len;Re++)if(ve[Re].storeId==s){marker=ve[Re];var n=new google.maps.LatLngBounds;n.extend(marker.getPosition()),le.fitBounds(n),Ne=n,I(240);break}}));var Ne=null;if(void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&1==wpslSettings.markerClusters){var Pe,Te,Oe,Re,Be;google.maps.event.addListener(le,"zoom_changed",function(){google.maps.event.addListenerOnce(le,"idle",function(){if(void 0!==we&&(Pe=we.clusters_,Pe.length))for(Re=0,Te=Pe.length;Re<Te;Re++)for(Be=0,Oe=Pe[Re].markers_.length;Be<Oe;Be++)if(Pe[Re].markers_[Be].storeId==ge){ue.getVisible()&&null===Pe[Re].markers_[Be].map?ue.setVisible(!1):ue.getVisible()||null===Pe[Re].markers_[Be].map||ue.setVisible(!0);break}})})}var ze={formatPhoneNumber:function(e){return 1==wpslSettings.phoneUrl&&m()&&(e="<a href='tel:"+ze.formatClickablePhoneNumber(e)+"'>"+e+"</a>"),e},formatClickablePhoneNumber:function(e){return-1!=e.indexOf("+")&&-1!=e.indexOf("(0)")&&(e=e.replace("(0)","")),e.replace(/(-| |\(|\)|\.|)/g,"")},createInfoWindowActions:function(t){var s,n="",i="";return e("#wpsl-gmap").length&&(xe&&(n="<a class='wpsl-streetview' href='#'>"+wpslLabels.streetView+"</a>"),1==wpslSettings.markerZoomTo&&(i="<a class='wpsl-zoom-here' href='#'>"+wpslLabels.zoomHere+"</a>"),s="<div class='wpsl-info-actions'>"+ze.createDirectionUrl(t)+n+i+"</div>"),s},createDirectionUrl:function(t){var s,n,i={};return 1==wpslSettings.directionRedirect?(void 0===he&&(he=""),i.target="target='_blank'",void 0!==t?i.src=e("[data-store-id="+t+"] .wpsl-directions").attr("href"):(n=this.zip?this.zip+", ":"",s=this.address+", "+this.city+", "+n+this.country,i.src="https://maps.google.com/maps?saddr="+ze.rfc3986EncodeURIComponent(he)+"&daddr="+ze.rfc3986EncodeURIComponent(s))):i={src:"#",target:""},"<a class='wpsl-directions' "+i.target+" href='"+i.src+"'>"+wpslLabels.directions+"</a>"},rfc3986EncodeURIComponent:function(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape)}};if(e("#wpsl-stores").on("click",".wpsl-store-details",function(){var t,s,n=e(this).parents("li"),i=n.data("store-id");if("info window"==wpslSettings.moreInfoLocation)for(t=0,s=ve.length;t<s;t++)ve[t].storeId==i&&google.maps.event.trigger(ve[t],"click");else n.find(".wpsl-more-info-listings").is(":visible")?e(this).removeClass("wpsl-active-details"):e(this).addClass("wpsl-active-details"),n.siblings().find(".wpsl-store-details").removeClass("wpsl-active-details"),n.siblings().find(".wpsl-more-info-listings").hide(),n.find(".wpsl-more-info-listings").toggle();if("default"!=wpslSettings.templateId||"store listings"==wpslSettings.moreInfoLocation)return!1}),e("a[href='#"+wpslSettings.mapTabAnchor+"']").length){var Ue,Ve,Ze=!!Number(wpslSettings.mapTabAnchorReturn);e("a[href='#"+wpslSettings.mapTabAnchor+"']").on("click",function(){return setTimeout(function(){Ue=le.getZoom(),Ve=le.getCenter(),google.maps.event.trigger(le,"resize"),le.setZoom(Ue),le.setCenter(Ve),X()},50),Ze})}e(document).on("change",'input[name="retailer"]',function(t){var s=document.getElementById("wpsl-search-input"),n=new Event("keyup");n.which=8,s.dispatchEvent(n);var i=e(this),o=i.closest("label");i.is(":checked")?o.removeClass("active").addClass("active"):o.removeClass("active"),e("#wpsl-search-btn").trigger("click")}),e(document).on("change",'input[name="range"],input[name="sub_range"]',function(t){e('input[name="collections"]').each(function(){e(this).prop("checked",!1),e(this).closest("label").removeClass("active")})
;var s=document.getElementById("wpsl-search-input"),n=new Event("keyup");n.which=8,s.dispatchEvent(n);var i=e(this),o=i.closest("label");i.is(":checked")?o.removeClass("active").addClass("active"):o.removeClass("active"),e("#wpsl-search-btn").trigger("click")}),e(document).on("change",'input[name="collections"]',function(t){e('input[name="range"],input[name="sub_range"]').each(function(){e(this).prop("checked",!1),e(this).closest("label").removeClass("active")});var s=document.getElementById("wpsl-search-input"),n=new Event("keyup");n.which=8,s.dispatchEvent(n);var i=e(this),o=i.closest("label");i.is(":checked")?o.removeClass("active").addClass("active"):o.removeClass("active"),e("#wpsl-search-btn").trigger("click")}),e(document).on("click","#mapView",function(t){if(Ie&&!Ee){google.maps.event.trigger(le,"resize");var s=e(".app-filter-result__detail-box");s.is(".opened")&&Ne?(le.fitBounds(Ne),s.hide()):X()}}),e(document).on("click","#listView",function(t){var s=e(".app-filter-result__detail-box");s.is(".opened")&&Ne&&s.show()}),e(document).on("mousedown touchstart",".pac-item.custom-item",function(t){var s=e(t.target);s.hasClass("custom-item")||(s=s.closest(".custom-item"));var n=s.find(".pac-item-query").text();e("#wpsl-search-input").val(n);var i=s.data("item-id"),o=s.data("item-lat"),a=s.data("item-lng");void 0!==i&&""!==i&&V(i,o,a)}),document.getElementById("listView").onclick=function(t){var t=t||window.event;t.target||t.srcElement,e("div").removeClass("tabsDisplayBg displaysNoneTabs"),e(".app-map-big").addClass("displaysNoneTabs"),e(".app-filter-result__tabs__detail").addClass("tabsDisplayBg")},document.getElementById("mapView").onclick=function(t){var t=t||window.event;t.target||t.srcElement,e("div").removeClass("tabsDisplayBg displaysNoneTabs"),e(".app-filter-result__list-box").addClass("displaysNoneTabs"),e(".app-filter-result__tabs__map-big").addClass("tabsDisplayBg")}});